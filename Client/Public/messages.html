<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Pigeon</title>
        <style>
            body {
                display: flex;
                margin: 0;
                height: 100vh;
            }
    
            #conversationList {
                width: 20%;
                background-color: #f0f0f0;
                padding: 20px;
                box-sizing: border-box;
            }
    
            #conversationDetails {
                flex: 1;
                padding: 20px;
                box-sizing: border-box;
            }
    
            #newConversationButton {
                margin-top: 10px;
                padding: 10px;
            }
        </style>
    </head>
<body>
    <div id="conversationList">
        <h2>Conversations</h2>
        <ul id="conversationLinks">
            <!-- Conversation links will be loaded here dynamically -->
        </ul>
        <button id="newConversationButton" onclick="startNewConversation()">New Conversation</button>
    </div>

    <div id="conversationDetails">
        <h2>Conversation Details</h2>
        <div id="conversationContent">
            <!-- Conversation content will be loaded here -->
        </div>

        <form id="messageForm">
            <label for="message">Enter your message:</label>
            <input type="text" id="message" name="message" required>
            <button type="button" onclick="sendMessage()">Send</button>
        </form>
    </div>

    <script>
        const username = sessionStorage.getItem('username');

        const usernameHeader = document.getElementById('usernameHeader');
        if (username) {
            usernameHeader.textContent = 'Messages for ' + username;
        } else {
            usernameHeader.textContent = 'Messages!';
        }

        function sendMessage() {
            // Simulate sending a message to the server (HTTP request).
            const messageInput = document.getElementById('message');
            const message = messageInput.value;

            // For simplicity, we'll just log the message to the console.
            console.log(`Sending message: ${message}`);
        }

        function loadConversations() {
            const conversationLinks = document.getElementById('conversationLinks');
            conversationLinks.innerHTML = '';

            const serverUrl = 'http://' + 'localhost' + ':' + 3000 + '/getAllConversations?username=' + sessionStorage.getItem('username');
            console.log(`Sending request to: ${serverUrl}`);

            fetch(serverUrl)
                .then(response => response.json())
                .then(conversations => {
                    conversations.forEach(conversation => {
                        const listItem = document.createElement('li');
                        const link = document.createElement('a');
                        link.href = '#';
                        link.onclick = () => loadConversation(conversation.id);
                        link.textContent = conversation.title;
                        listItem.appendChild(link);
                        conversationLinks.appendChild(listItem);
                    });
                })
                .catch(error => {
                    console.error('Error fetching conversations:', error);
                });
        }

        function loadConversation(conversationId) {
            // You can use AJAX or fetch to load the conversation content
            // For simplicity, we'll just update the content directly
            document.getElementById('conversationContent').innerHTML = `Loading conversation ${conversationId}...`;
        }

        function startNewConversation() {
            // Implement logic to start a new conversation
            alert('Starting a new conversation...');
        }

        window.onload = loadConversations;
    </script>
</body>
</html>